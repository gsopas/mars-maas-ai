<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mars Weather (Curiosity / MAAS)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main>
    <h1>Mars Weather</h1>
    <p class="subtitle">Curiosity/REMS via MAAS .</p>

    <p class="subtitle" id="backendHint">
      Paste: <code id="backendUrl">https://mars-maas.onrender.com</code>
      <button class="copy-btn" id="copyBackend" aria-label="Copy backend URL" title="Copy">Copy</button>
      <span id="copyMsg" class="copy-msg" role="status" aria-live="polite"></span>
    </p>

    <div class="controls">
      <input id="backend" placeholder="https://mars-maas-backend.onrender.com" />
      <input id="sol" type="number" placeholder="Sol (optional)" />
      <button id="go">Fetch</button>
    </div>

    <!-- ⬇️ output area -->
    <pre id="out">Set backend URL and click Fetch…</pre>
  </main>

  <script>
  (function () {
    // Copy-to-clipboard
    const btn = document.getElementById('copyBackend');
    const urlEl = document.getElementById('backendUrl');
    const msg = document.getElementById('copyMsg');
    btn.addEventListener('click', async () => {
      const text = (urlEl.textContent || '').trim().replace(/\.$/, '');
      try {
        await navigator.clipboard.writeText(text);
        msg.textContent = 'Copied';
      } catch {
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        msg.textContent = 'Copied';
      }
      setTimeout(() => { msg.textContent = ''; }, 1200);
    });

    // Fetch logic
    const backendInput = document.getElementById('backend');
    const solInput = document.getElementById('sol');
    const go = document.getElementById('go');
    const out = document.getElementById('out');

    // optionally auto-fill from localStorage
    backendInput.value = localStorage.getItem('BACKEND_URL') || '';

    go.addEventListener('click', async () => {
      const base = (backendInput.value || '').trim().replace(/\.$/, '');
      if (!base) { out.textContent = 'Enter your backend URL above.'; return; }

      // Compose path: /weather/latest or /weather/{sol}
      const path = solInput.value ? `/weather/${encodeURIComponent(solInput.value)}` : '/weather/latest';
      const url = base + path;

      out.textContent = 'Loading…';
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        out.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        out.textContent = 'Error: ' + e.message + '\nURL: ' + url;
      }
    });
  })();
  </script>
</body>
</html>
